{
  "schema_version": "1.6.3",
  "id": "CVE-2022-23628",
  "modified": "2024-05-20T16:03:47Z",
  "published": "2022-07-27T20:27:33Z",
  "aliases": [
    "GHSA-hcw3-j74m-qc58",
    "GO-2022-0316"
  ],
  "related": [],
  "summary": "Incorrect calculation in github.com/open-policy-agent/opa. OPA is an open source, general-purpose policy engine. Under certain conditions, pretty-printing an abstract syntax tree (AST) that contains synthetic nodes could change the logic of some statements by reordering array literals. Example of policies impacted are those that parse and compare web paths. **All of these** three conditions have to be met to create an adverse effect: 1. An AST of Rego had to be **created programmatically** such that it ends up containing terms without a location (such as wildcard variables). 2. The AST had to be **pretty-printed** using the `github.com/open-policy-agent/opa/format` package. 3. The result of the pretty-printing had to be **parsed and evaluated again** via an OPA instance using the bundles, or the Golang packages. If any of these three conditions are not met, you are not affected. Notably, all three would be true if using **optimized bundles**, i.e. bundles created with `opa build -O=1` or higher. In that case, the optimizer would fulfil condition (1.), the result of that would be pretty-printed when writing the bundle to disk, fulfilling (2.). When the bundle was then used, we'd satisfy (3.). As a workaround users may disable optimization when creating bundles. OPA es un motor de políticas de propósito general y de código abierto. Bajo determinadas condiciones, la impresión bonita de un árbol de sintaxis abstracta (AST) que contiene nodos sintéticos podría cambiar la lógica de algunas sentencias al reordenar los literales del array. Un ejemplo de políticas afectadas son las que analizan y comparan las rutas web. **Todas estas** tres condiciones tienen que cumplirse para crear un efecto adverso: 1. Un AST de Rego tuvo que ser **creado programáticamente** de tal manera que termina conteniendo términos sin ubicación (como variables comodín). 2. El AST tuvo que ser **impreso** usando el paquete \"github.com/open-policy-agent/opa/format\". 3. El resultado de la impresión bonita tuvo que ser **analizado y evaluado de nuevo** por medio de una instancia OPA usando los paquetes, o los paquetes Golang. Si alguna de estas tres condiciones no es cumplida, no está afectado. En particular, las tres condiciones son cumplidas si son usados **paquetes optimizados**, es decir, paquetes creados con \"opa build -O=1\" o superior. En ese caso, el optimizador cumpliría la condición (1.), cuyo resultado sería impreso al escribir el bundle en el disco, cumpliendo (2.). Cuando es usado el paquete, se cumpliría (3.). Como medida de mitigación solución, los usuarios pueden deshabilitar la optimización cuando son creados los paquetes. CWE-682",
  "details": "Pretty-printing an AST that contains synthetic nodes can change the logic of some statements by reordering array literals. OPA is an open source, general-purpose policy engine. Under certain conditions, pretty-printing an abstract syntax tree (AST) that contains synthetic nodes could change the logic of some statements by reordering array literals. Example of policies impacted are those that parse and compare web paths. **All of these** three conditions have to be met to create an adverse effect: 1. An AST of Rego had to be **created programmatically** such that it ends up containing terms without a location (such as wildcard variables). 2. The AST had to be **pretty-printed** using the `github.com/open-policy-agent/opa/format` package. 3. The result of the pretty-printing had to be **parsed and evaluated again** via an OPA instance using the bundles, or the Golang packages. If any of these three conditions are not met, you are not affected. Notably, all three would be true if using **optimized bundles**, i.e. bundles created with `opa build -O=1` or higher. In that case, the optimizer would fulfil condition (1.), the result of that would be pretty-printed when writing the bundle to disk, fulfilling (2.). When the bundle was then used, we'd satisfy (3.). As a workaround users may disable optimization when creating bundles",
  "severity": [
    {
      "type": "CVSS_V2",
      "score": "4.3"
    },
    {
      "type": "CVSS_V3",
      "score": "5.3"
    }
  ],
  "affected": [
    {
      "package": {
        "name": "open-policy-agent/opa",
        "purl": "https://github.com/open-policy-agent/opa"
      },
      "severity": [],
      "ranges": [
        {
          "type": "SEMVER",
          "events": [
            {
              "introduced": "0.33.1"
            }
          ]
        }
      ]
    }
  ],
  "references": [
    {
      "type": "WEB",
      "url": "https://github.com/open-policy-agent/opa/security/advisories/GHSA-hcw3-j74m-qc58"
    },
    {
      "type": "WEB",
      "url": "https://github.com/open-policy-agent/opa/commit/932e4ffc37a590ace79e9b75ca4340288c220239"
    },
    {
      "type": "WEB",
      "url": "https://github.com/open-policy-agent/opa/commit/2bd8edab9e10e2dc9cf76ae8335ced0c224f3055"
    },
    {
      "type": "WEB",
      "url": "https://github.com/open-policy-agent/opa/commit/bfd984ddf93ef2c4963a08d4fdadae0bcf1a3717"
    },
    {
      "type": "WEB",
      "url": "https://github.com/open-policy-agent/opa/pull/3851"
    }
  ],
  "credits": [
    {
      "name": "Stephan Renatus",
      "type": "REMEDIATION_DEVELOPER"
    }
  ],
  "database_specific": {
    "metrics": {
      "cvssMetricV31": [
        {
          "source": "nvd@nist.gov",
          "type": "Primary",
          "cvssData": {
            "version": "3.1",
            "vectorString": "CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:N/I:L/A:N",
            "attackVector": "NETWORK",
            "attackComplexity": "LOW",
            "privilegesRequired": "NONE",
            "userInteraction": "NONE",
            "scope": "UNCHANGED",
            "confidentialityImpact": "NONE",
            "integrityImpact": "LOW",
            "availabilityImpact": "NONE",
            "baseScore": 5.3,
            "baseSeverity": "MEDIUM"
          },
          "exploitabilityScore": 3.9,
          "impactScore": 1.4
        },
        {
          "source": "security-advisories@github.com",
          "type": "Secondary",
          "cvssData": {
            "version": "3.1",
            "vectorString": "CVSS:3.1/AV:N/AC:L/PR:L/UI:N/S:U/C:L/I:L/A:L",
            "attackVector": "NETWORK",
            "attackComplexity": "LOW",
            "privilegesRequired": "LOW",
            "userInteraction": "NONE",
            "scope": "UNCHANGED",
            "confidentialityImpact": "LOW",
            "integrityImpact": "LOW",
            "availabilityImpact": "LOW",
            "baseScore": 6.3,
            "baseSeverity": "MEDIUM"
          },
          "exploitabilityScore": 2.8,
          "impactScore": 3.4
        }
      ],
      "cvssMetricV2": [
        {
          "source": "nvd@nist.gov",
          "type": "Primary",
          "cvssData": {
            "version": "2.0",
            "vectorString": "AV:N/AC:M/Au:N/C:N/I:P/A:N",
            "accessVector": "NETWORK",
            "accessComplexity": "MEDIUM",
            "authentication": "NONE",
            "confidentialityImpact": "NONE",
            "integrityImpact": "PARTIAL",
            "availabilityImpact": "NONE",
            "baseScore": 4.3
          },
          "baseSeverity": "MEDIUM",
          "exploitabilityScore": 8.6,
          "impactScore": 2.9,
          "acInsufInfo": false,
          "obtainAllPrivilege": false,
          "obtainUserPrivilege": false,
          "obtainOtherPrivilege": false,
          "userInteractionRequired": false
        }
      ]
    },
    "cwe_details": [
      {
        "cwe_id": "CWE-682",
        "name": "Primary",
        "description": "",
        "source": "security-advisories@github.com",
        "url": ""
      }
    ],
    "repositories": [
      {
        "url": "https://github.com/open-policy-agent/opa",
        "name": "open-policy-agent/opa",
        "description": "An open source, general-purpose policy engine.",
        "date_created": "2015-12-28 22:08:25",
        "date_last_push": "2022-08-26 22:02:55",
        "owner": "open-policy-agent",
        "forks_count": "960.0",
        "stars_count": "7027.0",
        "repo_language": "Go"
      }
    ],
    "nodes": [
      {
        "operator": "OR",
        "negate": false,
        "cpeMatch": [
          {
            "vulnerable": true,
            "criteria": "cpe:2.3:a:openpolicyagent:open_policy_agent:*:*:*:*:*:*:*:*",
            "matchCriteriaId": "31E0CE8B-C614-4F87-81DB-D24E321F81FF",
            "versionStartIncluding": "0.33.1",
            "versionEndExcluding": "0.37.0"
          }
        ]
      }
    ],
    "vulndb_data": {
      "url": "https://pkg.go.dev/vuln/GO-2022-0316",
      "review_status": "REVIEWED"
    },
    "datasources": {
      "govuln": true,
      "nvd": true,
      "cvefixes": true
    }
  }
}