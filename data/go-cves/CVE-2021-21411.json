{
  "schema_version": "1.6.3",
  "id": "CVE-2021-21411",
  "modified": "2021-04-06T12:42:17.673000Z",
  "published": "2021-03-26T21:15:13.630000Z",
  "aliases": [],
  "related": [],
  "summary": "OAuth2-Proxy is an open source reverse proxy that provides authentication with Google, Github or other providers. The `--gitlab-group` flag for group-based authorization in the GitLab provider stopped working in the v7.0.0 release. Regardless of the flag settings, authorization wasn't restricted. Additionally, any authenticated users had whichever groups were set in `--gitlab-group` added to the new `X-Forwarded-Groups` header to the upstream application. While adding GitLab project based authorization support in #630, a bug was introduced where the user session's groups field was populated with the `--gitlab-group` config entries instead of pulling the individual user's group membership from the GitLab Userinfo endpoint. When the session groups where compared against the allowed groups for authorization, they matched improperly (since both lists were populated with the same data) so authorization was allowed. This impacts GitLab Provider users who relies on group membership for authorization restrictions. Any authenticated users in your GitLab environment can access your applications regardless of `--gitlab-group` membership restrictions. This is patched in v7.1.0. There is no workaround for the Group membership bug. But `--gitlab-project` can be set to use Project membership as the authorization checks instead of groups; it is not broken. OAuth2-Proxy es un proxy inverso de código abierto que proporciona autenticación con Google, Github u otros proveedores. El flag \"--gitlab-group\" para la autorización basada en grupos en el proveedor GitLab dejó de funcionar en la versión v7.0.0. Independientemente de la configuración del flag, la autorización no estaba restringida. Además, cualquier usuario autenticado tenía los grupos que habían sido establecidos en \"--gitlab-group\" añadidos al nuevo encabezado \"X-Forwarded-Groups\" para la aplicación de origen. Al añadir la compatibilidad con la autorización basada en proyectos de GitLab en el número 630, se introdujo un error por el que el campo groups de la sesión del usuario se rellenaba con las entradas de configuración de \"--gitlab-group\" en lugar de extraer la pertenencia al grupo del usuario individual desde el endpoint de GitLab Userinfo. Cuando los grupos de la sesión se comparaban con los grupos permitidos para la autorización, coincidían incorrectamente (ya que ambas listas se rellenaban con los mismos datos), por lo que se permitía la autorización. Esto afecta a usuarios del proveedor de GitLab que se basan en la pertenencia a grupos para las restricciones de autorización. Cualquier usuario autenticado en su entorno de GitLab puede acceder a sus aplicaciones independientemente de las restricciones de pertenencia a grupos de \"--gitlab-group\". Esto ha  sido corregido en la versión 7.1.0. No se presenta una solución para el error de Group membership. Pero \"--gitlab-project\" puede ser configurado para usar Project membership como la comprobación de la autorización en lugar de los grupos; esto no está roto.. CWE-863",
  "details": "OAuth2-Proxy is an open source reverse proxy that provides authentication with Google, Github or other providers. The `--gitlab-group` flag for group-based authorization in the GitLab provider stopped working in the v7.0.0 release. Regardless of the flag settings, authorization wasn't restricted. Additionally, any authenticated users had whichever groups were set in `--gitlab-group` added to the new `X-Forwarded-Groups` header to the upstream application. While adding GitLab project based authorization support in #630, a bug was introduced where the user session's groups field was populated with the `--gitlab-group` config entries instead of pulling the individual user's group membership from the GitLab Userinfo endpoint. When the session groups where compared against the allowed groups for authorization, they matched improperly (since both lists were populated with the same data) so authorization was allowed. This impacts GitLab Provider users who relies on group membership for authorization restrictions. Any authenticated users in your GitLab environment can access your applications regardless of `--gitlab-group` membership restrictions. This is patched in v7.1.0. There is no workaround for the Group membership bug. But `--gitlab-project` can be set to use Project membership as the authorization checks instead of groups; it is not broken",
  "severity": [
    {
      "type": "CVSS_V2",
      "score": "5.5"
    },
    {
      "type": "CVSS_V3",
      "score": "5.5"
    }
  ],
  "affected": [
    {
      "package": {
        "name": "oauth2-proxy/oauth2-proxy",
        "purl": "https://github.com/oauth2-proxy/oauth2-proxy"
      },
      "severity": [],
      "ranges": [
        {
          "type": "SEMVER",
          "events": [
            {
              "introduced": "7.0.0"
            }
          ]
        }
      ]
    }
  ],
  "references": [
    {
      "type": "WEB",
      "url": "https://docs.gitlab.com/ee/user/group/"
    },
    {
      "type": "WEB",
      "url": "https://github.com/oauth2-proxy/oauth2-proxy/commit/0279fa7dff1752f1710707dbd1ffac839de8bbfc"
    },
    {
      "type": "WEB",
      "url": "https://github.com/oauth2-proxy/oauth2-proxy/releases/tag/v7.1.0"
    },
    {
      "type": "WEB",
      "url": "https://github.com/oauth2-proxy/oauth2-proxy/security/advisories/GHSA-652x-m2gr-hppm"
    },
    {
      "type": "WEB",
      "url": "https://pkg.go.dev/github.com/oauth2-proxy/oauth2-proxy/v7"
    }
  ],
  "credits": [
    {
      "name": "Nick Meves",
      "type": "REMEDIATION_DEVELOPER"
    }
  ],
  "database_specific": {
    "metrics": {
      "cvssMetricV31": [
        {
          "source": "nvd@nist.gov",
          "type": "Primary",
          "cvssData": {
            "version": "3.1",
            "vectorString": "CVSS:3.1/AV:N/AC:L/PR:H/UI:N/S:C/C:L/I:L/A:N",
            "attackVector": "NETWORK",
            "attackComplexity": "LOW",
            "privilegesRequired": "HIGH",
            "userInteraction": "NONE",
            "scope": "CHANGED",
            "confidentialityImpact": "LOW",
            "integrityImpact": "LOW",
            "availabilityImpact": "NONE",
            "baseScore": 5.5,
            "baseSeverity": "MEDIUM"
          },
          "exploitabilityScore": 2.3,
          "impactScore": 2.7
        },
        {
          "source": "security-advisories@github.com",
          "type": "Secondary",
          "cvssData": {
            "version": "3.1",
            "vectorString": "CVSS:3.1/AV:N/AC:L/PR:H/UI:N/S:C/C:L/I:L/A:N",
            "attackVector": "NETWORK",
            "attackComplexity": "LOW",
            "privilegesRequired": "HIGH",
            "userInteraction": "NONE",
            "scope": "CHANGED",
            "confidentialityImpact": "LOW",
            "integrityImpact": "LOW",
            "availabilityImpact": "NONE",
            "baseScore": 5.5,
            "baseSeverity": "MEDIUM"
          },
          "exploitabilityScore": 2.3,
          "impactScore": 2.7
        }
      ],
      "cvssMetricV2": [
        {
          "source": "nvd@nist.gov",
          "type": "Primary",
          "cvssData": {
            "version": "2.0",
            "vectorString": "AV:N/AC:L/Au:S/C:P/I:P/A:N",
            "accessVector": "NETWORK",
            "accessComplexity": "LOW",
            "authentication": "SINGLE",
            "confidentialityImpact": "PARTIAL",
            "integrityImpact": "PARTIAL",
            "availabilityImpact": "NONE",
            "baseScore": 5.5
          },
          "baseSeverity": "MEDIUM",
          "exploitabilityScore": 8.0,
          "impactScore": 4.9,
          "acInsufInfo": false,
          "obtainAllPrivilege": false,
          "obtainUserPrivilege": false,
          "obtainOtherPrivilege": false,
          "userInteractionRequired": false
        }
      ]
    },
    "cwe_details": [
      {
        "cwe_id": "CWE-863",
        "name": "Primary",
        "description": "",
        "source": "security-advisories@github.com",
        "url": ""
      }
    ],
    "repositories": [
      {
        "url": "https://github.com/oauth2-proxy/oauth2-proxy",
        "name": "oauth2-proxy/oauth2-proxy",
        "description": "A reverse proxy that provides authentication with Google, Azure, OpenID Connect and many more identity providers.",
        "date_created": "2017-09-29 10:59:10",
        "date_last_push": "2022-08-26 06:54:13",
        "owner": "oauth2-proxy",
        "forks_count": "1042.0",
        "stars_count": "5671.0",
        "repo_language": "Go"
      }
    ],
    "nodes": [
      {
        "operator": "OR",
        "negate": false,
        "cpeMatch": [
          {
            "vulnerable": true,
            "criteria": "cpe:2.3:a:oauth2_proxy_project:oauth2_proxy:*:*:*:*:*:*:*:*",
            "matchCriteriaId": "A5AAF6F8-6CAE-4E37-9DD9-28C967852020",
            "versionStartIncluding": "7.0.0",
            "versionEndExcluding": "7.1.0"
          }
        ]
      }
    ],
    "datasources": {
      "govuln": false,
      "nvd": true,
      "cvefixes": true
    }
  }
}